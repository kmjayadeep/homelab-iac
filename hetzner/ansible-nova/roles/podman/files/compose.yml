version: '3.8'

services:
  psuite-syncthing:
    image: docker.io/linuxserver/syncthing:2.0.11
    container_name: psuite-syncthing
    hostname: psuite-hetzner
    restart: always
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Europe/Zurich
    volumes:
      - /opt/podman-compose/mounts/syncthing/data:/data
      - /opt/podman-compose/mounts/syncthing/config:/config
    ports:
      - "8384:8384"  # Web UI
      - "22000:22000/tcp"  # Sync protocol (TCP)
      - "22000:22000/udp"  # Sync protocol (UDP)  
    networks:
      - psuite-network
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:8384/rest/noauth/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

  psuite-wiki:
    image: docker.io/zefhemel/silverbullet:2.2.1
    container_name: psuite-wiki
    hostname: psuite-wiki
    restart: always
    environment:
      - SB_FOLDER=/psuite-data/psuite-wiki/data
      - SB_NAME=Wiki
      - SB_DESCRIPTION=Jayadeep's personal Wiki
      - GUID=1000
      - PUID=1000
      - SB_USER=wiki:${WIKI_PASSWORD}
    volumes:
      - /opt/podman-compose/mounts/syncthing/data:/psuite-data
    ports:
      - "3000:3000"
    networks:
      - psuite-network
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:3000"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s

  psuite-fava:
    image: docker.io/yegle/fava:latest
    container_name: psuite-fava
    hostname: psuite-fava
    restart: always
    environment:
      - BEANCOUNT_FILE=/psuite-data/psuite-beancount/journal.beancount
      - PUID=1000
      - PGID=1000
    volumes:
      - /opt/podman-compose/mounts/syncthing/data:/psuite-data
    ports:
      - "5000:5000"
    networks:
      - psuite-network
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:5000"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s

networks:
  psuite-network:
    driver: bridge
    enable_ipv6: true
    ipam:
      config:
        - subnet: "fd00:db8:1::/64"
          gateway: "fd00:db8:1::1"
